# V1 Milestone — Memory-Bounded Layer Streaming Runtime

## Objective
Build a Rust runtime that:
- loads model layers on demand,
- enforces a hard memory budget for model allocations only,
- and fails or degrades cleanly when the model exceeds its memory budget.

This milestone focuses only on correctness of memory control and layer streaming.

---

## In Scope (V1)
- Model-only memory arena with fixed capacity
- Layer load / unload lifecycle (AirLLM-style)
- Simple scheduler policy:
  - on memory quota exceeded → early-exit OR reject request
- Minimal toy model to exercise the runtime
- Basic metrics (in-process counters):
  - model arena usage
  - peak model arena usage
  - inference latency
  - quota-exceeded count
- Unit tests and one end-to-end test

---

## Out of Scope (V1)
- GPU memory management
- Thermal or system-wide memory control
- Real object detection models
- Frame capture / orchestration
- Containers or deployment tooling
- Performance optimization

---

## Definition of Done (V1 is complete when all are true)
- [ ] ModelArena enforces a hard capacity limit
- [ ] LayerWeights load/unload correctly manage arena memory
- [ ] Runtime does not exceed model arena capacity under stress
- [ ] Memory quota exceedance triggers early-exit or request rejection
- [ ] No OS OOM occurs in any test
- [ ] Unit tests cover arena accounting and layer streaming
- [ ] End-to-end test runs a toy model through the runtime

---

## Implementation Notes
- All model weights and activations must allocate through `ModelArena`
- Non-model memory (frames, logs, runtime structures) must not use the model arena
- Prefer simple allocation strategies (bump or pool allocator)
- Layer residency should be explicit and deterministic
- Keep concurrency minimal for V1 (serialize layer load/unload)

---

## Deliverables
- `runtime/` crate with:
  - `ModelArena`
  - `LayerWeights`
  - `Scheduler`
- `examples/toy_model` runnable demo
- `tests/` for arena limits and quota-exceeded flow
- `docs/design.md` updated with final V1 architecture

---

## Stop Condition
Once the Definition of Done checklist is satisfied, V1 is considered complete.
Do not add new features to V1 after this point.
